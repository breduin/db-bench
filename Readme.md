# Тестирование производительности баз данных

- Clickhouse
- Garnet
- Keydb
- MariaDB
- Mongo
- Postgresql
- Redis
- Scylla

## Настройка

Количество записей по умолчанию: 10 000, указывается в переменной NUM_RECORDS в файле main.py или в командной строке при запуске.

Длина одной записи по умолчанию: 1 000 символов, указывается в переменной VALUE_LENGTH в файле main.py или в командной строке при запуске.

## Методика тестирования

Генерируется NUM_RECORDS записей, каждая запись состоит из ключа и значения (ключ - число, значение - строка длиной VALUE_LENGTH символов).

### Неоптимизированные тесты

Чтение: производится запись ключ=значение для всех NUM_RECORDS записей по одной записи за раз в цикле.

Поиск и чтение: производится поиск по ключу и проверка значения для всех NUM_RECORDS записей по одной записи за раз в цикле.

### Тесты с пакетным запросом

Чтение: производится запись ключ=значение для всех NUM_RECORDS записей одним пакетом в соответствии с возможностями базы данных.

Поиск и чтение: производится поиск по ключу и проверка значения для всех NUM_RECORDS записей одним пакетом в соответствии с возможностями базы данных.

# Установка

Требуется Docker, Docker Compose и опционально make.

Создать виртуальное окружение
```
python -m venv env
```

Активировать виртуальное окружение
```
source env/bin/activate
```

Установить зависимости
```
pip install -r requirements.txt
```

# Запуск

Запустить контейнеры с базами данных:

```
docker compose up -d
```
или
```
make run
```

Запустить тестирование:
```
python main.py <количество записей> <длина записи>
```
Запуск без параметров запустит тестирование с параметрами по умолчанию.

Остановить контейнеры с базами данных:
```
docker compose down
```
или
```
make stop
```

# Результаты тестирования

Могут выглядеть примерно так:

```
--------------------------------------------------
Неоптимизированные тесты
--------------------------------------------------
Clickhouse      | запись     |################################| 10000/10000 10.35 секунд
Garnet          | запись     |################################| 10000/10000 1.00 секунд
Keydb           | запись     |################################| 10000/10000 1.00 секунд
Mongo           | запись     |################################| 10000/10000 2.34 секунд
Postgresql      | запись     |################################| 10000/10000 1.07 секунд
Redis           | запись     |################################| 10000/10000 1.01 секунд
Scylla          | запись     |################################| 10000/10000 2.95 секунд
MariaDB         | запись     |################################| 10000/10000
Clickhouse      | чтение     |################################| 10000/10000 43.87 секунд
Garnet          | чтение     |################################| 10000/10000 1.02 секунд
Keydb           | чтение     |################################| 10000/10000 0.98 секунд
Mongo           | чтение     |################################| 10000/10000 15.08 секунд
Postgresql      | чтение     |################################| 10000/10000 8.13 секунд
Redis           | чтение     |################################| 10000/10000 0.93 секунд
Scylla          | чтение     |################################| 10000/10000 4.10 секунд
MariaDB         | чтение     |################################| 10000/10000
--------------------------------------------------
Тесты с пакетным запросом
--------------------------------------------------
Clickhouse      | запись     |################################| 1/1 0.03 секунд
Garnet          | запись     |################################| 1/1 0.06 секунд
Keydb           | запись     |################################| 1/1 0.05 секунд
Mongo           | запись     |################################| 1/1 0.12 секунд
Postgresql      | запись     |################################| 1/1 0.86 секунд
Redis           | запись     |################################| 1/1 0.05 секунд
Scylla          | запись     |################################| 10000/10000 1.04 секунд
MariaDB         | запись     |################################| 1/1
Clickhouse      | чтение     |################################| 10000/10000 0.12 секунд
Garnet          | чтение     |################################| 10000/10000 0.09 секунд
Keydb           | чтение     |################################| 10000/10000 0.09 секунд
Mongo           | чтение     |################################| 10000/10000 0.11 секунд
Postgresql      | чтение     |################################| 10000/10000 0.10 секунд
Redis           | чтение     |################################| 10000/10000 0.09 секунд
Scylla          | чтение     |################################| 10000/10000 0.18 секунд
MariaDB         | чтение     |################################| 10000/10000

Количество записей: 10000
Длина одной записи: 1000
--------------------------------
Результаты тестирования записи (неоптимизированно):
База данных     Время (секунд)       Статус
--------------------------------------------------
keydb           1.00 (самая быстрая)
garnet          1.00 (0.17% медленнее)
redis           1.01 (0.76% медленнее)
postgresql      1.07 (6.99% медленнее)
mariadb         1.82 (81.22% медленнее)
mongo           2.34 (133.77% медленнее)
scylla          2.95 (194.74% медленнее)
clickhouse      10.35 (933.24% медленнее)

Результаты тестирования чтения (неоптимизированно):
База данных     Время (секунд)       Статус
--------------------------------------------------
redis           0.93 (самая быстрая)
keydb           0.98 (4.93% медленнее)
garnet          1.02 (9.18% медленнее)
mariadb         1.57 (67.96% медленнее)
scylla          4.10 (339.75% медленнее)
postgresql      8.13 (771.18% медленнее)
mongo           15.08 (1515.78% медленнее)
clickhouse      43.87 (4602.06% медленнее)

Результаты тестирования записи (с пакетным запросом):
База данных     Время (секунд)       Статус
--------------------------------------------------
clickhouse      0.03 (самая быстрая)
keydb           0.05 (30.23% медленнее)
redis           0.05 (31.08% медленнее)
garnet          0.06 (63.59% медленнее)
mongo           0.12 (240.55% медленнее)
mariadb         0.52 (1383.54% медленнее)
postgresql      0.86 (2379.93% медленнее)
scylla          1.04 (2900.07% медленнее)

Результаты тестирования чтения (с пакетным запросом):
База данных     Время (секунд)       Статус
--------------------------------------------------
mariadb         0.09 (самая быстрая)
garnet          0.09 (0.62% медленнее)
redis           0.09 (4.01% медленнее)
keydb           0.09 (6.17% медленнее)
postgresql      0.10 (13.57% медленнее)
mongo           0.11 (27.89% медленнее)
clickhouse      0.12 (32.38% медленнее)
scylla          0.18 (105.31% медленнее)
```