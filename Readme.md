# Тестирование производительности баз данных

- Clickhouse
- Garnet
- Keydb
- Mongo
- Postgresql
- Redis
- Scylla

## Настройка

Количество записей: 10 000, указывается в переменной NUM_RECORDS в файле main.py

Длина одной записи: 1 000 символов, указывается в переменной VALUE_LENGTH в файле main.py

## Методика тестирования

Генерируется NUM_RECORDS записей, каждая запись состоит из ключа и значения (ключ - число, значение - строка длиной VALUE_LENGTH символов).

### Неоптимизированные тесты

Чтение: производится запись ключ=значение для всех NUM_RECORDS записей по одной записи за раз в цикле.

Поиск и чтение: производится поиск по ключу и проверка значения для всех NUM_RECORDS записей по одной записи за раз в цикле.

### Тесты с пакетным запросом

Чтение: производится запись ключ=значение для всех NUM_RECORDS записей одним пакетом в соответствии с возможностями базы данных.

Поиск и чтение: производится поиск по ключу и проверка значения для всех NUM_RECORDS записей одним пакетом в соответствии с возможностями базы данных.

# Установка

Требуется Docker, Docker Compose и опционально make.

Создать виртуальное окружение
```
python -m venv env
```

Активировать виртуальное окружение
```
source env/bin/activate
```

Установить зависимости
```
pip install -r requirements.txt
```

# Запуск

Запустить контейнеры с базами данных:

```
docker compose up -d
```
или
```
make run
```

Запустить тестирование:
```
python main.py
```

Остановить контейнеры с базами данных:
```
docker compose down
```
или
```
make stop
```

# Результаты тестирования

Могут выглядеть примерно так:

```
--------------------------------------------------
Неоптимизированные тесты
--------------------------------------------------
Clickhouse      | запись     |################################| 10000/10000 11.73 секунд
Garnet          | запись     |################################| 10000/10000 1.10 секунд
Keydb           | запись     |################################| 10000/10000 1.12 секунд
Mongo           | запись     |################################| 10000/10000 2.49 секунд
Postgresql      | запись     |################################| 10000/10000 1.08 секунд
Redis           | запись     |################################| 10000/10000 1.01 секунд
Scylla          | запись     |################################| 10000/10000 3.24 секунд
Clickhouse      | чтение     |################################| 10000/10000 45.46 секунд
Garnet          | чтение     |################################| 10000/10000 1.18 секунд
Keydb           | чтение     |################################| 10000/10000 1.10 секунд
Mongo           | чтение     |################################| 10000/10000 17.86 секунд
Postgresql      | чтение     |################################| 10000/10000 9.82 секунд
Redis           | чтение     |################################| 10000/10000 0.97 секунд
Scylla          | чтение     |################################| 10000/10000 4.86 секунд
--------------------------------------------------
Тесты с пакетным запросом
--------------------------------------------------
Clickhouse      | запись     |################################| 1/1 0.05 секунд
Garnet          | запись     |################################| 1/1 0.05 секунд
Keydb           | запись     |################################| 1/1 0.05 секунд
Mongo           | запись     |################################| 1/1 0.10 секунд
Postgresql      | запись     |################################| 1/1 0.92 секунд
Redis           | запись     |################################| 1/1 0.04 секунд
Scylla          | запись     |################################| 10000/10000 4.40 секунд
Clickhouse      | чтение     |################################| 10000/10000 0.20 секунд
Garnet          | чтение     |################################| 10000/10000 0.17 секунд
Keydb           | чтение     |################################| 10000/10000 0.12 секунд
Mongo           | чтение     |################################| 10000/10000 0.26 секунд
Postgresql      | чтение     |################################| 10000/10000 0.16 секунд
Redis           | чтение     |################################| 10000/10000 0.13 секунд
Scylla          | чтение     |################################| 10000/10000 0.23 секунд

Количество записей: 10000
Длина одной записи: 1000
--------------------------------
Результаты тестирования записи (неоптимизированно):
База данных     Время (секунд)       Статус
--------------------------------------------------
redis           1.01 (самая быстрая)
postgresql      1.08 (7.00% медленнее)
garnet          1.10 (8.98% медленнее)
keydb           1.12 (10.63% медленнее)
mongo           2.49 (146.47% медленнее)
scylla          3.24 (220.78% медленнее)
clickhouse      11.73 (1060.42% медленнее)

Результаты тестирования чтения (неоптимизированно):
База данных     Время (секунд)       Статус
--------------------------------------------------
redis           0.97 (самая быстрая)
keydb           1.10 (12.96% медленнее)
garnet          1.18 (21.24% медленнее)
scylla          4.86 (399.19% медленнее)
postgresql      9.82 (908.95% медленнее)
mongo           17.86 (1735.94% медленнее)
clickhouse      45.46 (4572.11% медленнее)

Результаты тестирования записи (с пакетным запросом):
База данных     Время (секунд)       Статус
--------------------------------------------------
redis           0.04 (самая быстрая)
clickhouse      0.05 (10.09% медленнее)
keydb           0.05 (14.96% медленнее)
garnet          0.05 (23.62% медленнее)
mongo           0.10 (146.25% медленнее)
postgresql      0.92 (2096.25% медленнее)
scylla          4.40 (10430.70% медленнее)

Результаты тестирования чтения (с пакетным запросом):
База данных     Время (секунд)       Статус
--------------------------------------------------
keydb           0.12 (самая быстрая)
redis           0.13 (7.53% медленнее)
postgresql      0.16 (28.52% медленнее)
garnet          0.17 (37.89% медленнее)
clickhouse      0.20 (63.50% медленнее)
scylla          0.23 (92.42% медленнее)
mongo           0.26 (111.21% медленнее)
```