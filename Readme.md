# Тестирование производительности баз данных

- Clickhouse
- Garnet
- Keydb
- Mongo
- Postgresql
- Redis
- Scylla

## Настройка

Количество записей по умолчанию: 10 000, указывается в переменной NUM_RECORDS в файле main.py или в командной строке при запуске.

Длина одной записи по умолчанию: 1 000 символов, указывается в переменной VALUE_LENGTH в файле main.py или в командной строке при запуске.

## Методика тестирования

Генерируется NUM_RECORDS записей, каждая запись состоит из ключа и значения (ключ - число, значение - строка длиной VALUE_LENGTH символов).

### Неоптимизированные тесты

Чтение: производится запись ключ=значение для всех NUM_RECORDS записей по одной записи за раз в цикле.

Поиск и чтение: производится поиск по ключу и проверка значения для всех NUM_RECORDS записей по одной записи за раз в цикле.

### Тесты с пакетным запросом

Чтение: производится запись ключ=значение для всех NUM_RECORDS записей одним пакетом в соответствии с возможностями базы данных.

Поиск и чтение: производится поиск по ключу и проверка значения для всех NUM_RECORDS записей одним пакетом в соответствии с возможностями базы данных.

# Установка

Требуется Docker, Docker Compose и опционально make.

Создать виртуальное окружение
```
python -m venv env
```

Активировать виртуальное окружение
```
source env/bin/activate
```

Установить зависимости
```
pip install -r requirements.txt
```

# Запуск

Запустить контейнеры с базами данных:

```
docker compose up -d
```
или
```
make run
```

Запустить тестирование:
```
python main.py <количество записей> <длина записи>
```
Запуск без параметров запустит тестирование с параметрами по умолчанию.

Остановить контейнеры с базами данных:
```
docker compose down
```
или
```
make stop
```

# Результаты тестирования

Могут выглядеть примерно так:

```
--------------------------------------------------
Неоптимизированные тесты
--------------------------------------------------
Clickhouse      | запись     |################################| 10000/10000 11.35 секунд
Garnet          | запись     |################################| 10000/10000 1.09 секунд
Keydb           | запись     |################################| 10000/10000 1.05 секунд
Mongo           | запись     |################################| 10000/10000 2.46 секунд
Postgresql      | запись     |################################| 10000/10000 1.09 секунд
Redis           | запись     |################################| 10000/10000 1.02 секунд
Scylla          | запись     |################################| 10000/10000 3.18 секунд
Clickhouse      | чтение     |################################| 10000/10000 43.25 секунд
Garnet          | чтение     |################################| 10000/10000 1.08 секунд
Keydb           | чтение     |################################| 10000/10000 1.04 секунд
Mongo           | чтение     |################################| 10000/10000 17.27 секунд
Postgresql      | чтение     |################################| 10000/10000 8.83 секунд
Redis           | чтение     |################################| 10000/10000 0.96 секунд
Scylla          | чтение     |################################| 10000/10000 4.35 секунд
--------------------------------------------------
Тесты с пакетным запросом
--------------------------------------------------
Clickhouse      | запись     |################################| 1/1 0.04 секунд
Garnet          | запись     |################################| 1/1 0.06 секунд
Keydb           | запись     |################################| 1/1 0.04 секунд
Mongo           | запись     |################################| 1/1 0.11 секунд
Postgresql      | запись     |################################| 1/1 0.81 секунд
Redis           | запись     |################################| 1/1 0.04 секунд
Scylla          | запись     |################################| 10000/10000 1.12 секунд
Clickhouse      | чтение     |################################| 10000/10000 0.15 секунд
Garnet          | чтение     |################################| 10000/10000 0.12 секунд
Keydb           | чтение     |################################| 10000/10000 0.12 секунд
Mongo           | чтение     |################################| 10000/10000 0.15 секунд
Postgresql      | чтение     |################################| 10000/10000 0.17 секунд
Redis           | чтение     |################################| 10000/10000 0.13 секунд
Scylla          | чтение     |################################| 10000/10000 0.23 секунд

Количество записей: 10000
Длина одной записи: 1000
--------------------------------
Результаты тестирования записи (неоптимизированно):
База данных     Время (секунд)       Статус
--------------------------------------------------
redis           1.02 (самая быстрая)
keydb           1.05 (3.15% медленнее)
postgresql      1.09 (6.68% медленнее)
garnet          1.09 (6.83% медленнее)
mongo           2.46 (142.15% медленнее)
scylla          3.18 (212.55% медленнее)
clickhouse      11.35 (1015.56% медленнее)

Результаты тестирования чтения (неоптимизированно):
База данных     Время (секунд)       Статус
--------------------------------------------------
redis           0.96 (самая быстрая)
keydb           1.04 (8.33% медленнее)
garnet          1.08 (12.78% медленнее)
scylla          4.35 (353.70% медленнее)
postgresql      8.83 (821.18% медленнее)
mongo           17.27 (1700.80% медленнее)
clickhouse      43.25 (4410.68% медленнее)

Результаты тестирования записи (с пакетным запросом):
База данных     Время (секунд)       Статус
--------------------------------------------------
clickhouse      0.04 (самая быстрая)
keydb           0.04 (13.30% медленнее)
redis           0.04 (15.54% медленнее)
garnet          0.06 (47.23% медленнее)
mongo           0.11 (194.89% медленнее)
postgresql      0.81 (2020.30% медленнее)
scylla          1.12 (2813.13% медленнее)

Результаты тестирования чтения (с пакетным запросом):
База данных     Время (секунд)       Статус
--------------------------------------------------
garnet          0.12 (самая быстрая)
keydb           0.12 (0.61% медленнее)
redis           0.13 (9.07% медленнее)
mongo           0.15 (19.08% медленнее)
clickhouse      0.15 (21.32% медленнее)
postgresql      0.17 (36.81% медленнее)
scylla          0.23 (87.06% медленнее)
```